# Assignment 1

## Execution
We started by cloning the assignment repository and created the virtual machine (VM). Then we changed the repository to the assignment 1 repository and ran the program from the command-line 
`$ python assignment_1.py`

## Output

### What is the output of this program?

By running the assignment_1.py script, the program outputs three different files, respectively **price_list.txt**, **price_list.csv** and **prices.png**. 

**Price_list.txt** - TXT is a file extension for a text file, used by many different text editors. Text is a human-readable sequence of characters and the words they form can be encoded into computer-readable formats. **Price_list.txt** contains the following values Street, City, Price and Sqm. 

**Price_list.csv** - CSV (comma separated values) allows data to be saved in a table structure format. Generally they take the form of a text file containing information separated be commas. This file format can be used with any spreadsheet application, such as Microsoft Excel or Google Spreadsheets. **Price_list.csv** contains the following values Street, City, Price, Sqm and Price_per_sqm. 

**Prices_png** - PNG (Portable Network Graphics) uses lossless compression and is generally considered the replacement to the GIF format, but PNG does not support animations. PNG files are typically used to store graphics on websites. **Price.png** contains a graphical/map illustration of the different prices and sqm. 

The **Price_list.csv** file retrieves the following data: *Street*, *City*, *Price* and *Sqm* from the **Price_List.txt** file. The **Price_list.csv** file calculates the Price_per_sqm by using the price attribute and the Sqm attribute. (Price/Sqm).

## Files

### List the all files that this program generates.

#### Price_list.txt

  * Ved Volden 5, 5. TV; 1425 København K	4000000	91
  * Rådhusstræde 4C, 1; 1466 København K	4895000	105
  * Store Kongensgade 112A, 3; 1264 København K	250000	135
  * Amaliegade 13G, 2; 1256 København K	7375000	98
  * Borgergade 144, 3. TH; 1300 København K	5825000	101
  * Nørre Søgade 9A, 1. TH; 1370 København K	1126250	107
  * Wildersgade 22, ST; 1408 København K	1556700	88
  * Toldbodgade 10A, 1; 1253 København K	3750000	184
  * Andreas Bjørns Gade 4, 3. TH; 1428 København K	1700000	54
  * Sølvgade 15, 4. TH; 1307 København K	4215000	81
  * Linnésgade 16A, 1; 1361 København K	6300000	155
  * Store Kongensgade 63A, ST. 4; 1264 København K	1780000	98
  * Peder Skrams Gade 28, 2. TV; 1054 København K	4080000	76
  * Brobergsgade 14, 1. TV; 1427 København K	2750000	50
  * Sølvgade 13, 2. TV; 1307 København K	3150000	73
  * Ny Adelgade 9, 2. TH; 1104 København K	1950000	70
  * Lavendelstræde 9, 2. TV; 1462 København K	1550000	66
  * Åbenrå 10, 2. 5; 1124 København K	1650000	70
  * Grønnegade 31, 3. TV; 1107 København K	1200000	49
  * Badstuestræde 16, 2; 1209 København K	2700000	97
  * Nørre Voldgade 70, 4; 1358 København K	1870000	99
  * Fredericiagade 25, 5. 1; 1310 København K	3150000	118
  * Sølvgade 19, 2. MF; 1307 København K	2425000	49
  * David Balfours Gade 3, ST. TV; 1402 København K	3100000	83
  * Vimmelskaftet 36A, 3. TH; 1161 København K	3695000	84
  * Store Kongensgade 110C, 3. TV; 1264 København K	3050000	118
  * Andreas Bjørns Gade 10, 3. TV; 1428 København K	2367000	53
  * Grønnegade 31, 4; 1107 København K	3950000	73
  * Peder Skrams Gade 27, 3. TH; 1054 København K	6250000	112
  * Andreas Bjørns Gade 22, 3. TH; 1428 København K	2900000	55
  * Kronprinsessegade 10, 4. TV; 1306 København K	4350000	101
  * Bartholinsgade 11, 1. TV; 1356 København K	841000	52
  * Sankt Peders Stræde 17, 2; 1453 København K	4125000	106
  * Ved Volden 11, 4. TH; 1425 København K	4900000	97
  * Luftmarinegade 38; 1432 København K	2485131	137
  * Gernersgade 5, ST. TV; 1319 København K	1950000	37
  * Ahlefeldtsgade 26, 4. TV; 1359 København K	2115000	82
  * Dronningens Tværgade 36, 4. 1; 1302 København K	1785000	82
  * Nikolajgade 20, 2. TV; 1068 København K	3500000	92
  * Strandgade 12, 3; 1401 København K	7170000	228
  * Store Kongensgade 90, 2. TH; 1264 København K	7500000	158
  * Gothersgade 147, 3. TV; 1123 København K	3622500	68


#### Prices.png

![Text](https://github.com/HakimiX/BusinessIntelligence/blob/master/Assignment1/prices.png)

#### Price_list.csv


   Street    |      City     |     Price     |      Sqm      | Price per sqm |
------------ | ------------- | ------------- | ------------- | ------------- |
Ved Volden 5, 5. TV | 1425 København K | 4000000 | 91 | 43956 
Rådhusstræde 4C, 1 | 1466 København K | 4895000 | 105 | 46619 
Ved Volden 5, 5. TV | 1425 København K | 4000000 | 91 | 43956
ådhusstræde 4C, 1 | 1466 København K | 4895000 | 105 | 46619
Store Kongensgade 112A, 3 | 1264 København K | 250000 | 135 | 1851
Amaliegade 13G, 2 | 1256 København K | 7375000 | 98 | 75255
Borgergade 144, 3. TH | 1300 København K | 5825000 | 101 | 57673
Nørre Søgade 9A, 1. TH | 1370 København K | 1126250	| 107 | 10525
Wildersgade 22, ST | 1408 København K | 1556700 | 88 | 17689
Toldbodgade 10A, 1 | 1253 København K | 3750000	| 184 | 20380
Andreas Bjørns Gade 4, 3. TH | 1428 København K	| 1700000 | 54 | 31481




### Python Code

#### Describe in natural language and line-by-line what the program is doing. Describe also for each line what the Python code expresses.

```python
import os
import csv
import requests
import platform 
import statistics
import matplotlib
matplotlib.use('agg')
import matplotlib.pyplot as plt
```


The lines of code above are import statements. When the interpreter encounters an import statement, it imports the modules. Modules make the code easier to understand and use, by logically organizing python code. 


```python
def download_txt(url, save_path='./downloaded'):
    response = requests.get(url)
    with open(save_path, 'wb') as f:
        f.write(response.content)
```


The **download_txt()** function downloades text from a url and saves the text in a certain path './downloaded'

```python
def generate_csv(txt_input_path, csv_output_path):
    with open(txt_input_path, encoding='utf-8') as f:
        txt_content = f.readlines()

    rows = [['street', 'city', 'price', 'sqm', 'price_per_sqm']]
    for line in txt_content:
        line = line.rstrip().replace('  * ', '')
        address, price, sqm = line.split('\t')
        street, city = address.split('; ')
        price_per_sqm = int(price) // int(sqm)
        row = (street, city, price, sqm, price_per_sqm)
        rows.append(row)

    if platform.system() == 'Windows':
        newline=''
    else:
        newline=None

    with open(csv_output_path, 'w', newline=newline, encoding='utf-8') as f:
        output_writer = csv.writer(f)
        for row in rows:
            output_writer.writerow(row)
```


The **generate_csv()** function generates a CSV file with the right format (utf-8) and rows (Street, City, Price, Sqm, Price per sqm). The function also translates the downloaded data/format into readable CSV format, because a CSV file is comma separated, so the function replaces all ' * ' with ' , '. Price_per_sqm is also calculated by dividing price with sqm `int(price) // int(sqm)`


```python
def read_prices(csv_input_path):
    with open(csv_input_path, encoding='utf-8') as f:
        reader = csv.reader(f)
        _ = next(reader)

        idxs = []
        prices = []
        for row in reader:
            _, _, price, _, _ = row
            idxs.append(reader.line_num)
            prices.append(int(price))

    return list(zip(idxs, prices))
```


The **read_prices()** function reades the prices from the CSV file


```python
def compute_avg_price(data):
    _, prices = zip(*data)
    avg_price = statistics.mean(prices)

    with open('/tmp/avg_price.txt', 'w', encoding='utf-8') as f:
        f.write(str(avg_price))

    return avg_price
```


The **compute_avg()** function calculates the average price 


```python
def generate_plot(data):

    x_values, y_values = zip(*data)
    fig = plt.figure()
    plt.scatter(x_values, y_values, s=100)
    fig.savefig('./prices.png', bbox_inches='tight')
```


The **generate_plot()** function generates data for the scatter chart (Prices.png) 


```python
def run():
    file_url = 'https://raw.githubusercontent.com/datsoftlyngby/' \
               'soft2017fall-business-intelligence-teaching-material/master/' \
               'assignments/assignment_1/price_list.txt'
    txt_file_name = os.path.basename(file_url)
    txt_path = os.path.join('./', txt_file_name)
    download_txt(file_url, txt_path)
    csv_file_name = 'price_list.csv'
    csv_path = os.path.join(os.getcwd(), csv_file_name)
    generate_csv(txt_path, csv_path)
    data = read_prices(csv_path)
    avg_price = compute_avg_price(data)
    print(avg_price)
    generate_plot(data)


if __name__ == '__main__':
    run()
```


The **run()** function is intended to run the code. It indicates where to fetch the data and uses the various functions to fetch data, calculate prices, generate files (csv, png) and prints average price








